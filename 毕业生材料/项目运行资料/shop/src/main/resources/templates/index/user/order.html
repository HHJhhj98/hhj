<!doctype html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <base th:href="@{/}">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
<title>name</title>

    <link href="css/bootstrap.css" th:href="@{static/index/css/bootstrap.css}" rel="stylesheet" type="text/css" />
    <link href="css/home.css" th:href="@{static/index/css/home.css}" rel="stylesheet" type="text/css" />

<link href="http://at.alicdn.com/t/font_l6a0fwucxvzehfr.css" rel="stylesheet" type="text/css" />


</head>

<body>

<!--top-->
<div class="top_c">
	<a href="/shop/index/user_personal" class="iconfont icon-jiantou-copy-copy"></a>
	<p class="titi">我的订单</p>
</div>

<!--头部-->
<div class="pos">
	<div class="container">
    	<div class="row titll">
        	<a href="javascript:;" onclick="info_order(1)"><div class="col-xs-3 order_div" style="color:#246fc0;" >全部</div></a>
            <a href="javascript:;" onclick="info_order(2)"><div class="col-xs-3 order_div" style="color: #5e5e5e" >待支付</div></a>
            <a href="javascript:;" onclick="info_order(3)"><div class="col-xs-3 order_div" style="color: #5e5e5e" >待提货</div></a>
            <a href="javascript:;" onclick="info_order(4)"><div class="col-xs-3 order_div" style="color: #5e5e5e" >已提货</div></a>

        </div>
    </div>
</div>

<!--列表-->

<div class="ding_d" id="ding_d">
	<div class="on_d">
        <a href="details.html">
            <p class="bh">订单编号：4878555166555<span>待支付</span></p>
        </a>
        <div class="sp_pr">
            <a href="business.html" >
                <img src="images/sp.jpg" class="col-xs-2 col-md-2">
            </a>
            <div class="text_p col-xs-7 col-md-5" >
                <a href="business.html">
                    <p style="color: #222222">康师傅香辣牛肉面</p>
                </a>
                <span class="yue" ><em style="color: #ec3535">3月12日16:00提货</em></span>
                <span class="yue"><em class="em_s" style="font-size: 16px;color: #ec3535">￥200</em></span>

            </div>
            <div class="xuan-order col-xs-1 col-md-3" style="padding-right: 40px">
                <p>*<em style="font-size: 20px">1</em></p>
            </div>
        </div>

        <div class="sp_pr">
            <a href="business.html" >
                <img src="images/sp.jpg" class="col-xs-2 col-md-2">
            </a>
            <div class="text_p col-xs-7 col-md-5" >
                <a href="business.html">
                    <p style="color: #222222">康师傅香辣牛肉面</p>
                </a>
                <span class="yue" ><em style="color: #ec3535">3月12日16:00提货</em></span>
                <span class="yue"><em class="em_s" style="font-size: 16px;color: #ec3535">￥200</em></span>

            </div>
            <div class="xuan-order col-xs-1 col-md-3" style="padding-right: 40px">
                <p>*<em style="font-size: 20px">1</em></p>
            </div>
        </div>
        <div style="margin-top: 10px">
            <p style="margin-left: 20px" >提货号：<em style="float: right;margin-right: 20px">订单合计：200.00</em></p>
        </div>
        <div class="button">
        	<a href="#" class="liji">立即支付</a>
            <a href="#" class="qu">取消订单</a>
        </div>
    </div>

    <div class="on_d">
    	<p class="bh">订单编号：4878555166555<span>待提货</span></p>
        <div class="sp_pr">
            <a href="business.html" >
                <img src="images/sp.jpg" class="col-xs-2 col-md-2">
            </a>
            <div class="text_p col-xs-7 col-md-5" >
                <a href="business.html">
                    <p style="color: #222222">康师傅香辣牛肉面</p>
                </a>
                <span class="yue" ><em style="color: #ec3535">3月12日16:00提货</em></span>
                <span class="yue"><em class="em_s" style="font-size: 16px;color: #ec3535">￥200</em></span>

            </div>
            <div class="xuan-order col-xs-1 col-md-3" style="padding-right: 40px">
                <p>*<em style="font-size: 20px">1</em></p>
            </div>
        </div>

        <div class="sp_pr">
            <a href="business.html" >
                <img src="images/sp.jpg" class="col-xs-2 col-md-2">
            </a>
            <div class="text_p col-xs-7 col-md-5" >
                <a href="business.html">
                    <p style="color: #222222">康师傅香辣牛肉面</p>
                </a>
                <span class="yue" ><em style="color: #ec3535">3月12日16:00提货</em></span>
                <span class="yue"><em class="em_s" style="font-size: 16px;color: #ec3535">￥200</em></span>

            </div>
            <div class="xuan-order col-xs-1 col-md-3" style="padding-right: 40px">
                <p>*<em style="font-size: 20px">1</em></p>
            </div>
        </div>
        <div style="margin-top: 10px">
            <p style="margin-left: 20px" >提货号：1<em style="float: right;margin-right: 20px">订单合计：200.00</em></p>
        </div>
        <div class="button">
            <a href="#" class="liji">继续购物</a>
        </div>
    </div>

	
</div>

<script src="js/jquery.min.js" th:src="@{static/index/js/jquery.min.js}" type="text/javascript"></script>
<script src="js/orderAjax.js" th:src="@{static/index/js/orderAjax.js}" type="text/javascript"></script>
<script>
    var uid = sessionStorage.getItem('uid');
    var token = sessionStorage.getItem('token');
    function getFormatDate1(date1){
        var nowDate = new Date(date1);
        var year = nowDate.getFullYear();
        var month = nowDate.getMonth() + 1 < 10 ? "0" + (nowDate.getMonth() + 1) : nowDate.getMonth() + 1;
        var date = nowDate.getDate() < 10 ? "0" + (nowDate.getDate()+1) : (nowDate.getDate()+1);
        var hour = nowDate.getHours()< 10 ? "0" + nowDate.getHours() : nowDate.getHours();
        var minute = nowDate.getMinutes()< 10 ? "0" + nowDate.getMinutes() : nowDate.getMinutes();
        var second = nowDate.getSeconds()< 10 ? "0" + nowDate.getSeconds() : nowDate.getSeconds();
        return year + "-" + month + "-" + date+" "+"16:00:00";
    }
    info(uid,null,null);
    function info_order(id) {
        switch (id){
            case 1:
                $(".order_div").each(function(i,item){
                    if (i==0){
                        $(".order_div").eq(i).css("color","#246fc0");
                    }else {
                        $(".order_div").eq(i).css("color","#5e5e5e");
                    }
                });
                info(uid,null,null);
                break;
            case 2:
                $(".order_div").each(function(i,item){
                    if (i==1){
                        $(".order_div").eq(i).css("color","#246fc0");
                    }else {
                        $(".order_div").eq(i).css("color","#5e5e5e");
                    }
                });
                info(uid,null,0);
                break;
            case 3:
                $(".order_div").each(function(i,item){
                    if (i==2){
                        $(".order_div").eq(i).css("color","#246fc0");
                    }else {
                        $(".order_div").eq(i).css("color","#5e5e5e");
                    }
                });
                info(uid,null,1);
                break;
            default :
                $(".order_div").each(function(i,item){
                    if (i==3){
                        $(".order_div").eq(i).css("color","#246fc0");
                    }else {
                        $(".order_div").eq(i).css("color","#5e5e5e");
                    }
                });
                info(uid,null,2);
                break;
        }
    }
    function info(uid,mid,status) {
        $.ajax({
            url : "/shop/order/findByIdResult"
            , headers:{"token":token,
                "Access-Control-Allow-Origin":"*"}
            ,type : "get"
            ,data:{"uid":uid,"mid":mid,"status":status}
            ,contentType: 'application/json'
            ,success: function(data){
                // sessionStorage.setItem('token','token:PC-c4ca4238a0b923820dcc509a6f75849b-20210412090817473-554972');
                // sessionStorage.setItem('mid','1002');
                console.log(data);
                $('#ding_d').empty();   //清空resText里面的所有内容
                var html = '';
                $.each(data.data, function(commentIndex, comment){

                    console.log(comment);
                    var str='';
                    switch (comment.orderStatus){
                        case 0 :
                            str='待支付';
                            break;
                        case 1:
                            str='待提货';
                            break;
                        case 3 :
                            str='退货中';
                            break;
                        case 4:
                            str='已退货';
                            break;
                        case 5 :
                            str='已取消';
                            break;
                        default:
                            str='已提货';
                            break;
                    };
                    html += '<div class="on_d">\n' +
                        '    \t<p class="bh"><a href="javascript:;" onclick="details('+comment.oid+')">订单编号：'+comment.oid+'</a><span>'+str+
                        '</span></p>\n' ;
                    $.each(comment.goodsDTOList, function(i, c){
                        html+='        <div class="sp_pr">\n' +
                            '            <a href="javascript:;" onclick="commodity('+c.id+')">\n' +
                            '                <img src="'+c.photos+'" class="col-xs-2 col-md-2">\n' +
                            '            </a>\n' +
                            '            <div class="text_p col-xs-7 col-md-5" >\n' +
                            '                <a href="javascript:;" onclick="commodity('+c.id+')">\n' +
                            '                    <p style="color: #222222">'+c.goods_name+'</p>\n' +
                            '                </a>\n' +
                            '                <span class="yue" ><em style="color: #ec3535">'+getFormatDate1(comment.createtime*1000)+'提货</em></span>\n' +
                            '                <span class="yue"><em class="em_s" style="font-size: 16px;color: #ec3535">￥'+c.price+'</em></span>\n' +
                            '\n' +
                            '            </div>\n' +
                            '            <div class="xuan-order col-xs-1 col-md-3" style="padding-right: 40px">\n' +
                            '                <p>*<em style="font-size: 20px">'+c.number+'</em></p>\n' +
                            '            </div>\n' +
                            '        </div>\n';
                    });

                    switch (comment.orderStatus){
                        case 0 :
                            html+=' <div class="button">\n' +
                                '            <a href="javascript:;" class="qu" onclick="cancel('+comment.oid+')">取消订单</a>\n </div>';
                            break;
                        default:
                            html+=' <div class="button">\n' +
                                '            <a href="javascript:;" class="liji" onclick="returno('+comment.oid+')">申请退货</a>\n' +
                                '        </div>';
                            break;
                    }

                    html+= '</div>';

                });
                $('#ding_d').html(html);
            }
        });
    }
    function commodity(id) {
        sessionStorage.removeItem("goodsId");
        sessionStorage.setItem('goodsId',id);
        window.location.href='/shop/index/commodity';
    }

    function details(Oid) {
        sessionStorage.removeItem("Oid");
        sessionStorage.setItem('Oid',Oid);
        window.location.href='/shop/index/user_details';
    }
</script>


<script src="js/bootstrap.min.js" th:src="@{static/index/js/bootstrap.min.js}"  type="text/javascript"></script>
<script src="js/index.js" th:src="@{static/index/js/index.js}" type="text/javascript"></script>




</body>
</html>
